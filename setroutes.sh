#!/bin/vbash
if [ ! -f "/etc/dhcp3/dhclient-exit-hooks.d/routes" ]; then

read -r -d '' ROUTES <<- EndOfFile
IyBzZXQgY2xhc3NsZXNzIHJvdXRlcyBiYXNlZCBvbiB0aGUgZm9ybWF0IHNwZWNpZmllZCBpbiBS
RkMzNDQyCiMgZS5nLjoKIyAgIG5ld19yZmMzNDQyX2NsYXNzbGVzc19zdGF0aWNfcm91dGVzPScy
NCAxOTIgMTY4IDEwIDE5MiAxNjggMSAxIDggMTAgMTAgMTcgNjYgNDEnCiMgc3BlY2lmaWVzIHRo
ZSByb3V0ZXM6CiMgICAxOTIuMTY4LjEwLjAvMjQgdmlhIDE5Mi4xNjguMS4xCiMgICAxMC4wLjAu
MC84IHZpYSAxMC4xNy42Ni40MQojCiMvZXRjL2RoY3AzL2RoY2xpZW50LWV4aXQtaG9va3MuZC9y
b3V0ZXMKClJVTj0ieWVzIgoKCmlmIFsgIiRSVU4iID0gInllcyIgXTsgdGhlbgoJaWYgWyAtbiAi
JG5ld19yZmMzNDQyX2NsYXNzbGVzc19zdGF0aWNfcm91dGVzIiBdOyB0aGVuCgkJaWYgWyAiJHJl
YXNvbiIgPSAiQk9VTkQiIF0gfHwgWyAiJHJlYXNvbiIgPSAiUkVCT09UIiBdOyB0aGVuCgoJCQlz
ZXQgLS0gJG5ld19yZmMzNDQyX2NsYXNzbGVzc19zdGF0aWNfcm91dGVzCgoJCQl3aGlsZSBbICQj
IC1ndCAwIF07IGRvCgkJCQluZXRfbGVuZ3RoPSQxCgkJCQl2aWFfYXJnPScnCgoJCQkJY2FzZSAk
bmV0X2xlbmd0aCBpbgoJCQkJCTMyfDMxfDMwfDI5fDI4fDI3fDI2fDI1KQoJCQkJCQluZXRfYWRk
cmVzcz0iJHsyfS4kezN9LiR7NH0uJHs1fSIKCQkJCQkJZ2F0ZXdheT0iJHs2fS4kezd9LiR7OH0u
JHs5fSIKCQkJCQkJc2hpZnQgOQoJCQkJCQk7OwoJCQkJCTI0fDIzfDIyfDIxfDIwfDE5fDE4fDE3
KQoJCQkJCQluZXRfYWRkcmVzcz0iJHsyfS4kezN9LiR7NH0uMCIKCQkJCQkJZ2F0ZXdheT0iJHs1
fS4kezZ9LiR7N30uJHs4fSIKCQkJCQkJc2hpZnQgOAoJCQkJCQk7OwoJCQkJCTE2fDE1fDE0fDEz
fDEyfDExfDEwfDkpCgkJCQkJCW5ldF9hZGRyZXNzPSIkezJ9LiR7M30uMC4wIgoJCQkJCQlnYXRl
d2F5PSIkezR9LiR7NX0uJHs2fS4kezd9IgoJCQkJCQlzaGlmdCA3CgkJCQkJCTs7CgkJCQkJOHw3
fDZ8NXw0fDN8MnwxKQoJCQkJCQluZXRfYWRkcmVzcz0iJHsyfS4wLjAuMCIKCQkJCQkJZ2F0ZXdh
eT0iJHszfS4kezR9LiR7NX0uJHs2fSIKCQkJCQkJc2hpZnQgNgoJCQkJCQk7OwoJCQkJCTApCSMg
ZGVmYXVsdCByb3V0ZQoJCQkJCQluZXRfYWRkcmVzcz0iMC4wLjAuMCIKCQkJCQkJZ2F0ZXdheT0i
JHsyfS4kezN9LiR7NH0uJHs1fSIKCQkJCQkJc2hpZnQgNQoJCQkJCQk7OwoJCQkJCSopCSMgZXJy
b3IKCQkJCQkJcmV0dXJuIDEKCQkJCQkJOzsKCQkJCWVzYWMKCgkJCQkjIHRha2UgY2FyZSBvZiBs
aW5rLWxvY2FsIHJvdXRlcwoJCQkJaWYgWyAiJHtnYXRld2F5fSIgIT0gJzAuMC4wLjAnIF07IHRo
ZW4KCQkJCQl2aWFfYXJnPSJ2aWEgJHtnYXRld2F5fSIKCQkJCWZpCgoJCQkJIyBzZXQgcm91dGUg
KGlwIGRldGVjdHMgaG9zdCByb3V0ZXMgYXV0b21hdGljYWxseSkKCQkJCWlwIC00IHJvdXRlIGFk
ZCAiJHtuZXRfYWRkcmVzc30vJHtuZXRfbGVuZ3RofSIgJHt2aWFfYXJnfSBkZXYgIiR7aW50ZXJm
YWNlfSIgPi9kZXYvbnVsbCAyPiYxCgkJCWRvbmUKCQlmaQoJZmkKZmk=
EndOfFile

echo "$ROUTES" | base64 -d > /etc/dhcp3/dhclient-exit-hooks.d/routes
chmod +x /etc/dhcp3/dhclient-exit-hooks.d/routes
release dhcp interface eth0.4
renew dhcp interface eth0.4
restart igmp-proxy
fi

readonly logFile="/var/log/postprovisionroutes.log"

source /opt/vyatta/etc/functions/script-template

configure > ${logFile}

delete system task-scheduler task postprovisionroutes >> ${logFile}
commit
exit
